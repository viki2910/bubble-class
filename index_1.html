<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>버블버블 슈터 (모바일 대응)</title>
  <style>
    :root{--bg:#0b1024;--panel:#111827;--text:#e5e7eb;--accent:#38bdf8}
    html,body{height:100%;margin:0}
    body{
      display:grid;place-items:center;
      background:radial-gradient(1200px 800px at 70% -20%, #1f2937, #0b1024 60%, #050816 100%);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,sans-serif;color:var(--text);
      overflow:hidden;               /* 스크롤 방지 */
      touch-action:none;             /* 더블탭 확대 방지용 */
    }
    .wrap{width:100vw; max-width:560px}
    .hud{
      display:grid;grid-template-columns:1fr auto;gap:.5rem;align-items:center;
      background:rgba(17,24,39,.65);backdrop-filter:blur(4px);
      border:1px solid #263146;border-bottom:none;border-radius:16px 16px 0 0;
      padding:.5rem .8rem
    }
    .title{font-weight:700;letter-spacing:.2px;font-size:clamp(14px,3.2vw,16px)}
    .btns{display:flex;gap:.5rem}
    button{all:unset;background:#0f172a;border:1px solid #273247;padding:.35rem .7rem;border-radius:10px;cursor:pointer}
    button:active{transform:scale(.98)}
    canvas{display:block;background:linear-gradient(#0a1227,#071022);border:1px solid #263146;border-radius:0 0 16px 16px;width:100%}
    .tips{font-size:12px;opacity:.9;margin-top:.4rem;text-align:center}
    @media (min-width:600px){ .wrap{max-width:800px} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div class="title">🎯 같은 색 3개 이상 맞추면 제거!</div>
      <div class="btns">
        <button id="btnRestart">재시작</button>
        <button id="btnAddRow" title="난이도 업! 위에서 한 줄 추가">한 줄 추가</button>
      </div>
    </div>
    <canvas id="game" aria-label="버블버블 게임 캔버스"></canvas>
    <div class="tips">터치로 조준/발사(탭). A/D 각도, Space 발사, R 재시작</div>
  </div>

  <script>
  (()=> {
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');

    // --------- 런타임 변하는 값(리사이즈 대응) ----------
    let W = 360, H = 640;           // 논리 좌표(=CSS px)
    const TOP_MARGIN = 70;          // 상단 UI 높이
    const SIDE_MARGIN = 20;         // 좌우 여백
    let LAUNCH_Y = H - 110;

    // 그리드 파라미터(폭에 맞춰 동적 설정)
    let R = 18;                     // 버블 반지름
    let DIAM = R*2;
    let COLS = 12;                  // 짝수행 기준 열
    let ROW_H = Math.sqrt(3) * R;

    // 색상
    const COLORS = ['#ff6b6b','#ffd93d','#6bcB77','#4d96ff','#bb86fc','#ff9f1c'];

    // 상태
    const state = {
      grid: [], offsetRow: 0, aimAngle:
