<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>버블버블 슈터</title>
<style>
  body {
    margin: 0;
    background: #0b1425;
    color: white;
    font-family: "Noto Sans KR", sans-serif;
    text-align: center;
  }
  h1 { margin-top: 20px; }
  #gameContainer {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    background: #08111e;
    width: 90vw;
    max-width: 420px;
    height: auto;
    display: block;
    border-radius: 10px;
  }
  #info {
    margin: 10px;
    font-size: 16px;
  }
  button {
    background: #1e3a8a;
    border: none;
    color: white;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
  }
</style>
</head>
<body>
  <h1>버블버블 슈터</h1>
  <p>홈 화면에 추가해서 앱처럼 써보세요!</p>

  <div id="gameContainer">
    <div id="info">
      점수: <span id="score">0</span> | 남은 줄: <span id="rows">5</span>
    </div>
    <canvas id="gameCanvas"></canvas>
    <button onclick="restartGame()">다시 시작</button>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const rowsEl = document.getElementById("rows");

canvas.width = Math.min(window.innerWidth * 0.9, 420);
canvas.height = canvas.width * 1.2;

let bubbles = [];
let colors = ["#ff6b6b", "#ffd93d", "#6bcB77", "#4d96ff", "#c77dff"];
let shooter = { x: canvas.width / 2, y: canvas.height - 40, color: colors[0] };
let score = 0;
let rows = 5;
let bullet = null;

// 버블 초기화
function initBubbles() {
  bubbles = [];
  const r = 15;
  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < 12; col++) {
      if (row % 2 === 0 && col === 11) continue;
      const x = col * r * 2 + (row % 2 === 0 ? r : 0);
      const y = row * r * 2 + 30;
      bubbles.push({ x, y, color: colors[Math.floor(Math.random() * colors.length)], r });
    }
  }
}

// 버블 그리기
function drawBubbles() {
  bubbles.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
    ctx.fillStyle = b.color;
    ctx.fill();
    ctx.closePath();
  });
}

// 발사체
function drawShooter() {
  ctx.beginPath();
  ctx.arc(shooter.x, shooter.y, 15, 0, Math.PI * 2);
  ctx.fillStyle = shooter.color;
  ctx.fill();
  ctx.closePath();
}

// 발사
function shootBubble(targetX, targetY) {
  if (bullet) return; // 이미 발사 중
  const dx = targetX - shooter.x;
  const dy = targetY - shooter.y;
  const len = Math.sqrt(dx * dx + dy * dy);
  bullet = {
    x: shooter.x,
    y: shooter.y,
    dx: (dx / len) * 5,
    dy: (dy / len) * 5,
    color: shooter.color,
  };
}

// 게임 루프
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBubbles();
  drawShooter();

  if (bullet) {
    bullet.x += bullet.dx;
    bullet.y += bullet.dy;
    ctx.beginPath();
    ctx.arc(bullet.x, bullet.y, 10, 0, Math.PI * 2);
    ctx.fillStyle = bullet.color;
    ctx.fill();
    ctx.closePath();

    // 충돌 감지
    for (let i = 0; i < bubbles.length; i++) {
      const b = bubbles[i];
      const dist = Math.sqrt((bullet.x - b.x) ** 2 + (bullet.y - b.y) ** 2);
      if (dist < b.r + 10) {
        bubbles.splice(i, 1);
        score += 10;
        scoreEl.textContent = score;
        bullet = null;
        shooter.color = colors[Math.floor(Math.random() * colors.length)];
        break;
      }
    }

    // 화면 밖이면 리셋
    if (bullet && (bullet.y < 0 || bullet.x < 0 || bullet.x > canvas.width)) {
      bullet = null;
      shooter.color = colors[Math.floor(Math.random() * colors.length)];
    }
  }

  requestAnimationFrame(update);
}

// 이벤트 (터치 + 클릭)
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  shootBubble(e.clientX - rect.left, e.clientY - rect.top);
});

canvas.addEventListener("touchstart", e => {
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  shootBubble(touch.clientX - rect.left, touch.clientY - rect.top);
});

// 다시 시작
function restartGame() {
  score = 0;
  scoreEl.textContent = score;
  rows = 5;
  rowsEl.textContent = rows;
  bullet = null;
  shooter.color = colors[Math.floor(Math.random() * colors.length)];
  initBubbles();
}

initBubbles();
update();
</script>
</body>
</html>
